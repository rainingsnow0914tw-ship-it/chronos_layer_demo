<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronos Layer - Multimodal Time Reconstruction</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+TC:wght@400;700&family=Space+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --azulejo-blue: #1E3A8A;
            --azulejo-light: #3B82F6;
            --tile-white: #F8FAFC;
            --gold: #D4A017;
            --gold-light: #F5D782;
            --dark-bg: #0F172A;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Serif TC', serif;
            background: var(--dark-bg);
            color: var(--tile-white);
            min-height: 100vh;
        }

        .azulejo-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0.05;
            background-image: 
                repeating-linear-gradient(45deg, var(--azulejo-blue) 0, var(--azulejo-blue) 1px, transparent 0, transparent 50%),
                repeating-linear-gradient(-45deg, var(--azulejo-blue) 0, var(--azulejo-blue) 1px, transparent 0, transparent 50%);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: -1;
        }

        .header {
            text-align: center;
            padding: 1.5rem;
            border-bottom: 3px solid var(--azulejo-blue);
            background: linear-gradient(180deg, rgba(30, 58, 138, 0.3) 0%, transparent 100%);
            position: relative;
        }

        /* === LIVE DEMO BANNER === */
        .live-demo-banner {
            background: linear-gradient(135deg, #1E3A8A, #3B82F6);
            padding: 1.2rem 1rem;
            text-align: center;
            border-bottom: 2px solid var(--gold);
        }

        .banner-content {
            max-width: 900px;
            margin: 0 auto;
        }

        .banner-text {
            color: var(--tile-white);
            font-size: 1.05rem;
            margin-bottom: 0.8rem;
            line-height: 1.4;
        }

        .banner-text strong {
            color: var(--gold-light);
        }

        .btn-live-demo {
            display: inline-block;
            background: var(--gold);
            color: #0F172A;
            padding: 0.75rem 1.8rem;
            border-radius: 8px;
            font-weight: 700;
            text-decoration: none;
            font-family: 'Space Mono', monospace;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(212, 160, 23, 0.4);
            margin: 0.5rem 0;
        }

        .btn-live-demo:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(212, 160, 23, 0.6);
            background: var(--gold-light);
        }

        .banner-hint {
            color: rgba(248, 250, 252, 0.8);
            font-size: 0.8rem;
            margin-top: 0.6rem;
            font-style: italic;
            line-height: 1.3;
        }

        .lang-toggle {
            position: absolute;
            top: 1.5rem;
            right: 2rem;
            background: rgba(30, 58, 138, 0.3);
            border: 2px solid var(--azulejo-blue);
            color: var(--tile-white);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .lang-toggle:hover {
            background: rgba(59, 130, 246, 0.4);
            border-color: var(--gold);
            transform: translateY(-2px);
        }

        .logo {
            font-family: 'Cinzel', serif;
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(212, 160, 23, 0.5);
        }

        .tagline {
            font-size: 0.9rem;
            color: var(--azulejo-light);
            font-style: italic;
            margin-top: 0.3rem;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 1.5rem;
        }

        .photo-selection {
            background: rgba(30, 58, 138, 0.2);
            border: 2px solid var(--azulejo-blue);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .photo-selection h3 {
            font-family: 'Cinzel', serif;
            color: var(--gold);
            margin-bottom: 0.8rem;
            font-size: 1rem;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.8rem;
        }

        .photo-card {
            cursor: pointer;
            border: 3px solid transparent;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .photo-card:hover { 
            border-color: var(--azulejo-light); 
            transform: scale(1.02); 
        }

        .photo-card.active { 
            border-color: var(--gold); 
            box-shadow: 0 0 20px rgba(212, 160, 23, 0.4); 
        }

        /* å§¬è·¯åŸç‰¹æ®Šæ¨£å¼ - åªç”¨NEWå¾½ç« ï¼Œä¸ç”¨é‡‘æ¡† */
        .photo-card.special {
            /* ä¸é¡å¤–åŠ é‚Šæ¡†ï¼Œé¿å…èˆ‡é¸ä¸­ç‹€æ…‹æ··æ·† */
        }

        /* NEW å¾½ç«  - å§¬è·¯åŸç‰¹æ®Šæ¨™è¨˜
         * 
         * ç‚ºä»€éº¼åªæœ‰å§¬è·¯åŸæœ‰ NEW å¾½ç« ï¼Ÿ
         * 
         * æŠ€è¡“é›£åº¦ï¼š
         * - å‰3å€‹åœ°æ¨™ï¼ˆæ¾³é–€ï¼‰ï¼šåªé‡å»ºã€Œå»ºç¯‰ã€ï¼ˆç›¸å°ç°¡å–®ï¼‰
         * - å§¬è·¯åŸ + ç¥æˆ¶ï¼šæ¶‰åŠã€Œäººç‰©è½‰æ›ã€ï¼ˆæŠ€è¡“é›£åº¦å¤§å¹…æå‡ï¼‰
         * 
         * äººç‰©è½‰æ›çš„æŒ‘æˆ°ï¼š
         * 1. è‡‰éƒ¨ç‰¹å¾µä¿ç•™ï¼ˆæœ€é›£ï¼AI å®¹æ˜“ã€Œæ›è‡‰ã€è€Œä¸æ˜¯ã€Œè®Šè£ã€ï¼‰
         * 2. æœè£æ­·å²æº–ç¢ºæ€§ï¼ˆéœ€è¦ç ”ç©¶ 1600å¹´ Tosei-gusoku ç›”ç”²ç´°ç¯€ï¼‰
         * 3. å§¿å‹¢å”èª¿ï¼ˆç¾ä»£ä¼‘é–’å§¿å‹¢ vs æ­¦å£«ç«™å§¿ï¼‰
         * 4. èƒŒæ™¯èåˆï¼ˆåŸé®è¡—æ™¯ã€è·¯äººæœè£éƒ½è¦ç¬¦åˆæ™‚ä»£ï¼‰
         * 
         * ç‚ºä»€éº¼æ¨™è¨˜ç‚º NEWï¼š
         * - çªå‡ºã€ŒæŠ€è¡“çªç ´ã€ï¼šå¾å»ºç¯‰é‡å»ºå‡ç´šåˆ°äººç‰©ç©¿è¶Š
         * - å¼•å°ç”¨æˆ¶é—œæ³¨ï¼šé€™æ˜¯ Demo çš„äº®é»åŠŸèƒ½
         * - å±•ç¤ºèƒ½åŠ›ï¼šè­‰æ˜ç³»çµ±ä¸åªæ˜¯ã€Œæ¿¾é¡ã€ï¼Œè€Œæ˜¯ã€Œç†è§£ + é‡å»ºã€
         * 
         * ç‚ºä»€éº¼ç¥æˆ¶æ²’æœ‰ NEWï¼Ÿ
         * - å§¬è·¯åŸå·²ç¶“å±•ç¤ºäº†äººç‰©è½‰æ›èƒ½åŠ›
         * - ç¥æˆ¶çš„ç‰¹è‰²æ˜¯ã€ŒB&W ç…§ç‰‡æ•ˆæœã€ï¼ˆAI è‡ªå‹•æ¨ç† 1868 = é»‘ç™½æ™‚ä»£ï¼‰
         * - é¿å…éå¤šå¾½ç« é€ æˆè¦–è¦ºæ··äº‚
         */
        .new-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #FF6B6B, #FFD93D);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.65rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            z-index: 10;
            animation: badge-bounce 2s ease-in-out infinite;
        }

        @keyframes badge-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .photo-card img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            display: block;
        }

        .photo-card .card-label {
            padding: 0.4rem;
            font-size: 0.75rem;
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            color: var(--tile-white);
        }

        .photo-card .card-era {
            font-size: 0.65rem;
            color: var(--gold-light);
            opacity: 0.8;
        }

        .viewer-section {
            position: relative;
        }

        /* === LIVE DEMO CTA (Below Slider) === */
        .live-demo-cta {
            margin-top: 1.5rem;
            text-align: center;
            padding: 1.2rem;
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.3), rgba(59, 130, 246, 0.2));
            border-radius: 12px;
            border: 2px solid rgba(212, 160, 23, 0.3);
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            transition: all 0.3s ease;
        }

        .live-demo-cta:hover {
            border-color: var(--gold);
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.5), rgba(59, 130, 246, 0.3));
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(212, 160, 23, 0.2);
        }

        .btn-try-live {
            display: inline-block;
            background: linear-gradient(135deg, var(--gold), var(--gold-light));
            color: #0F172A;
            padding: 0.9rem 2rem;
            border-radius: 8px;
            font-weight: 700;
            text-decoration: none;
            font-family: 'Space Mono', monospace;
            font-size: 1.05rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(212, 160, 23, 0.4);
        }

        .btn-try-live:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(212, 160, 23, 0.6);
            background: linear-gradient(135deg, var(--gold-light), var(--gold));
        }

        .cta-hint {
            color: rgba(248, 250, 252, 0.8);
            font-size: 0.85rem;
            margin-top: 0.8rem;
            font-style: italic;
            line-height: 1.3;
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.8rem;
            background: rgba(30, 58, 138, 0.2);
            border: 2px solid var(--azulejo-blue);
            border-radius: 8px;
        }

        .action-bar h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            color: var(--gold);
        }

        .btn-primary {
            font-family: 'Space Mono', monospace;
            background: linear-gradient(135deg, var(--azulejo-blue), var(--azulejo-light));
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); 
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .slider-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9;
            border: 4px solid var(--azulejo-blue);
            border-radius: 10px;
            overflow: hidden;
            background: #000;
        }

        /* æ¨¡ç³ŠèƒŒæ™¯å±¤ */
        .slider-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(20px);
            opacity: 0.3;
            z-index: 0;
        }

        .slider-image {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            object-fit: contain;
            z-index: 1;
        }

        .slider-image.before { z-index: 2; }
        .slider-image.after {
            z-index: 3;
            clip-path: inset(0 100% 0 0);
            opacity: 0;
            transition: filter 3s ease-out, opacity 0.8s ease;
        }

        .slider-image.after.developing {
            filter: blur(20px) sepia(100%) brightness(0.5);
        }

        .slider-container.locked .slider-handle {
            cursor: not-allowed;
            opacity: 0.35;
            pointer-events: none;
        }

        .slider-container.locked .slider-image.after {
            pointer-events: none;
        }

        .slider-container.revealed .slider-image.after {
            opacity: 1;
        }

        .completion-modal {
            position: fixed;
            bottom: 22px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            border: 2px solid var(--gold);
            border-radius: 16px;
            padding: 12px 14px;
            z-index: 999;
            display: none;
            box-shadow: 0 0 25px rgba(212, 160, 23, 0.35);
            font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        }

        .completion-modal.show { display: flex; gap: 10px; align-items: center; }
        .completion-modal .msg { font-size: 0.9rem; color: #fff; opacity: 0.9; }
        .completion-modal button {
            border: 1px solid rgba(255,255,255,0.25);
            background: rgba(59, 130, 246, 0.15);
            color: #fff;
            padding: 10px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
        }

        .completion-modal button.primary {
            background: rgba(212, 160, 23, 0.18);
            border-color: rgba(212, 160, 23, 0.55);
        }

        .completion-modal button:hover { filter: brightness(1.08); }

        .photo-selection.inactive { opacity: 0.35; pointer-events: none; }
        .photo-selection.hidden { display: none; }

        .slider-handle {
            position: absolute;
            top: 0; bottom: 0; left: 50%;
            width: 4px;
            background: var(--gold);
            z-index: 10;
            cursor: ew-resize;
            box-shadow: 0 0 10px rgba(212, 160, 23, 0.8);
        }

        .slider-handle::before {
            content: 'â—„â–º';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--gold);
            color: var(--dark-bg);
            padding: 0.5rem;
            border-radius: 50%;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(212, 160, 23, 0.6);
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .panel-card {
            background: rgba(30, 58, 138, 0.2);
            border: 2px solid var(--azulejo-blue);
            border-radius: 10px;
            padding: 1rem;
        }

        .panel-card h4 {
            font-family: 'Cinzel', serif;
            color: var(--gold);
            margin-bottom: 0.8rem;
            font-size: 0.95rem;
        }

        .info-grid {
            display: grid;
            gap: 0.5rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            padding: 0.3rem 0;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
        }

        .info-label {
            color: var(--azulejo-light);
            font-weight: 600;
        }

        .info-value {
            color: var(--tile-white);
            font-family: 'Space Mono', monospace;
        }

        .tier-hero { color: #FFD700; font-weight: 700; }
        .tier-knowledge { color: #00CED1; font-weight: 700; }

        .confidence-bar {
            margin-top: 0.8rem;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--azulejo-blue), var(--gold));
            transition: width 0.5s ease;
        }

        .narrative-box {
            min-height: 120px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .narrative-text {
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.5s ease;
            margin-bottom: 0.8rem;
            color: var(--tile-white);
        }

        .narrative-text.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .assumptions-list {
            list-style: none;
            font-size: 0.8rem;
            line-height: 1.7;
        }

        .assumptions-list li {
            padding: 0.3rem 0;
            padding-left: 1rem;
            position: relative;
            color: var(--tile-white);
        }

        .assumptions-list li::before {
            content: 'â–¸';
            position: absolute;
            left: 0;
            color: var(--gold);
        }

        .footer {
            text-align: center;
            padding: 1.5rem;
            margin-top: 2rem;
            border-top: 2px solid var(--azulejo-blue);
            font-size: 0.85rem;
            color: var(--azulejo-light);
        }

        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            .photo-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* === AUTO-TRIGGER FIX === */
        /* éš±è— completion modal è£¡çš„ã€Œå†æ¬¡é‡å»ºã€æŒ‰éˆ• */
        .completion-modal button:last-child {
            display: none !important;
        }

        /* === PROCESSING OVERLAY ===
         * 
         * è¨­è¨ˆå“²å­¸ï¼š
         * åœ–ç‰‡ç”Ÿæˆæ˜¯è€—æ™‚æ“ä½œï¼ˆAI æ¨ç†éœ€è¦ 18-21 ç§’ï¼‰ï¼Œå–®ç´”çš„ loading spinner
         * æœƒè®“ç”¨æˆ¶æ„Ÿåˆ°ä¸è€ç…©ã€‚å› æ­¤è¨­è¨ˆäº†ã€Œå¤šå±¤æ¬¡åˆ†æ•£æ³¨æ„åŠ›ã€ç­–ç•¥ï¼š
         * 
         * ç¬¬1å±¤ï¼šéœ§é¢èƒŒæ™¯ (fog-effect)
         *    - è¦–è¦ºé®æ“‹ï¼Œå‘ŠçŸ¥ã€Œæ­£åœ¨è™•ç†ä¸­ã€
         *    - åŠé€æ˜ï¼Œä»èƒ½çœ‹åˆ°åº•ä¸‹çš„ before åœ–ç‰‡ï¼ˆç¶­æŒä¸Šä¸‹æ–‡ï¼‰
         * 
         * ç¬¬2å±¤ï¼šåœ°åŸŸå‰ç¥¥ç‰©å‹•ç•«
         *    - æ¾³é–€ï¼šèŠ±å…¬é› wiggleï¼ˆæ–‡åŒ–è­˜åˆ¥ + å¨›æ¨‚æ€§ï¼‰
         *    - æ—¥æœ¬ï¼šæ«»èŠ±é£„è½ï¼ˆæ°›åœç‡Ÿé€  + åœ°åŸŸç‰¹è‰²ï¼‰
         * 
         * ç¬¬3å±¤ï¼šAI Pipeline æ­¥é©Ÿå±•ç¤º
         *    - 5å€‹æ­¥é©Ÿé€æ­¥é¡¯ç¤ºï¼ˆæ¯0.6ç§’ä¸€å€‹ï¼Œå…±3ç§’ï¼‰
         *    - ç›®çš„ï¼šæ•™è‚²ç”¨æˆ¶ã€ŒAI åœ¨åšä»€éº¼ã€ï¼Œå¢åŠ é€æ˜åº¦
         *    - å‰¯ä½œç”¨ï¼šè®“ç­‰å¾…è®Šæˆã€Œå­¸ç¿’é«”é©—ã€
         * 
         * æ™‚é–“è¨­è¨ˆï¼š
         * - ç¸½æ™‚é•·ï¼š18ç§’ï¼ˆèˆ‡ narrative åŒæ­¥ï¼‰
         * - ç‚ºä»€éº¼18ç§’ï¼Ÿå› ç‚ºå¯¦éš› Gemini API å‘¼å«éœ€è¦é€™éº¼ä¹…
         * - çµæŸæ™‚æ©Ÿï¼šcompletion modal å‡ºç¾å‰æ¶ˆå¤±ï¼ˆé¿å…è¦–è¦ºè¡çªï¼‰
         * 
         * UX å¿ƒç†å­¸ï¼š
         * 1. é€²åº¦æ„Ÿï¼šPipeline é€æ­¥é¡¯ç¤º â†’ æ„Ÿè¦ºã€Œæœ‰é€²å±•ã€
         * 2. å¨›æ¨‚æ€§ï¼šå‹•ç•« â†’ æ¸›å°‘ç„¡èŠæ„Ÿ
         * 3. æ•™è‚²æ€§ï¼šè§£é‡‹ AI æµç¨‹ â†’ å¢åŠ ç”¨æˆ¶ç†è§£å’Œä¿¡ä»»
         */
        .processing-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .processing-overlay.active {
            display: flex;
            opacity: 1;
        }

        /* éœ§é¢æ•ˆæœ */
        .fog-effect {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(
                45deg,
                rgba(30, 58, 138, 0.3) 0%,
                rgba(59, 130, 246, 0.2) 50%,
                rgba(30, 58, 138, 0.3) 100%
            );
            animation: fog-drift 4s ease-in-out infinite;
        }

        @keyframes fog-drift {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        /* èŠ±å…¬é›å‹•ç•« (æ¾³é–€å°ˆç”¨)
         * 
         * è¨­è¨ˆè€ƒé‡ï¼š
         * - èŠ±å…¬é› (ğŸ“) æ˜¯æ¾³é–€çš„å®˜æ–¹å‰ç¥¥ç‰©
         * - é¸ç”¨åŸå› ï¼šå¼·åŒ–åœ°åŸŸè­˜åˆ¥ + emoji åŸç”Ÿæ”¯æ´ï¼ˆç„¡éœ€é¡å¤–åœ–ç‰‡è³‡æºï¼‰
         * - æ–‡åŒ–æ„ç¾©ï¼šä»£è¡¨æ¾³é–€ç‰¹è‰²ï¼Œèˆ‡è‘¡è„ç‰™æ®–æ°‘æ­·å²ç›¸é—œ
         * 
         * åŠŸèƒ½ç›®çš„ï¼š
         * 1. Loading indicator - å‘ŠçŸ¥ç”¨æˆ¶ AI æ­£åœ¨è™•ç†
         * 2. å¨›æ¨‚æ€§ - wiggle å‹•ç•«è®“ç­‰å¾…éç¨‹ä¸ç„¡èŠ
         * 3. åœ°åŸŸè­˜åˆ¥ - ä¸€çœ‹åˆ°å…¬é›å°±çŸ¥é“æ˜¯æ¾³é–€åœ°æ¨™
         * 
         * æŠ€è¡“å¯¦ä½œï¼š
         * - åªåœ¨æ¾³é–€3åœ°æ¨™é¡¯ç¤º (a_st_pauls, b_guia, c_st_dominic)
         * - æŒçºŒæ™‚é–“ï¼šèˆ‡ narrative æ’­æ”¾åŒæ­¥ï¼ˆç´„18ç§’ï¼‰
         * - å‹•ç•«ï¼šå·¦å³æ“ºå‹• + ä¸Šä¸‹è·³èºï¼Œ1ç§’å¾ªç’°
         */
        .chicken-mascot {
            font-size: 4rem;
            margin-bottom: 2rem;
            animation: chicken-wiggle 1s ease-in-out infinite;
            filter: drop-shadow(0 0 20px rgba(212, 160, 23, 0.5));
            display: none;
        }

        .processing-overlay.macau .chicken-mascot {
            display: block;
        }

        @keyframes chicken-wiggle {
            0%, 100% { transform: rotate(-5deg) translateY(0); }
            25% { transform: rotate(5deg) translateY(-10px); }
            50% { transform: rotate(-5deg) translateY(0); }
            75% { transform: rotate(5deg) translateY(-10px); }
        }

        /* æ«»èŠ±é£„è½å‹•ç•« (æ—¥æœ¬å°ˆç”¨)
         * 
         * è¨­è¨ˆè€ƒé‡ï¼š
         * - æ«»èŠ± (ğŸŒ¸) æ˜¯æ—¥æœ¬æœ€å…·ä»£è¡¨æ€§çš„æ–‡åŒ–ç¬¦è™Ÿ
         * - é¸ç”¨åŸå› ï¼šé€šä¿—æ˜“æ‡‚ + emoji åŸç”Ÿæ”¯æ´ + å¼·åŒ–åœ°åŸŸè­˜åˆ¥
         * - ç‚ºä»€éº¼ä¸ç”¨å…¶ä»–ï¼Ÿç´…è‘‰ã€å¯Œå£«å±±ç­‰åœ¨ emoji ä¸­ä¸å¤ æ˜é¡¯
         * 
         * åŠŸèƒ½ç›®çš„ï¼š
         * 1. Loading indicator - è¦–è¦ºåŒ– AI è™•ç†éç¨‹
         * 2. æ–‡åŒ–æ°›åœ - ç‡Ÿé€ æ—¥æœ¬æ­·å²å ´æ™¯çš„æ°›åœæ„Ÿ
         * 3. åœ°åŸŸè­˜åˆ¥ - æ«»èŠ± = æ—¥æœ¬ï¼Œæ¸…æ™°çš„è¦–è¦ºç·šç´¢
         * 
         * æŠ€è¡“å¯¦ä½œï¼š
         * - åªåœ¨æ—¥æœ¬2åœ°æ¨™é¡¯ç¤º (d_himeji, e_kobe)
         * - 20ç‰‡èŠ±ç“£ï¼Œéš¨æ©Ÿä½ç½®å’Œé€Ÿåº¦ï¼ˆé¿å…è¦å¾‹æ„Ÿï¼‰
         * - å‹•ç•«æ™‚é•·ï¼š4-7ç§’ï¼ˆæ¯”å…¬é›æ…¢ï¼Œç‡Ÿé€ é£„è½æ„Ÿï¼‰
         * - é€æ˜åº¦ï¼š0.4ï¼ˆsubtleï¼Œä¸æ¶èµ°ä¸»è¦å…§å®¹ç„¦é»ï¼‰
         */
        .sakura-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            display: none;
        }

        .processing-overlay.japan .sakura-container {
            display: block;
        }

        .sakura-petal {
            position: absolute;
            font-size: 1.5rem;
            opacity: 0.4;
            animation: sakura-fall linear infinite;
        }

        @keyframes sakura-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 0.6;
            }
            100% {
                transform: translateY(calc(100% + 500px)) rotate(360deg);
                opacity: 0;
            }
        }

        /* AI Pipeline æ­¥é©Ÿ */
        .pipeline-display {
            position: relative;
            z-index: 10;
            text-align: left;
            max-width: 600px;
        }

        .pipeline-step {
            font-family: 'Space Mono', monospace;
            font-size: 1rem;
            color: var(--tile-white);
            margin: 0.5rem 0;
            padding-left: 1.5rem;
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.4s ease;
        }

        .pipeline-step.visible {
            opacity: 1;
            transform: translateX(0);
        }

        .pipeline-step::before {
            content: 'â–¶';
            position: absolute;
            left: 0;
            color: var(--gold);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .pipeline-step.visible::before {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="azulejo-bg"></div>

    <header class="header">
        <h1 class="logo">CHRONOS LAYER</h1>
        <p class="tagline">Multimodal Time Reconstruction</p>
        <button class="lang-toggle" id="langToggle" onclick="toggleLanguage()">
            ğŸŒ EN
        </button>
    </header>

    <main class="main-container">
        <section class="viewer-section">
            <div class="photo-selection" id="photoSelection">
                <h3>ğŸ“ Select Landmark</h3>
                <div class="photo-grid">
                    <div class="photo-card active" data-landmark="a_st_pauls">
                        <img src="demo_assets/a_st_pauls_before.jpg" alt="Ruins of Saint Paul's">
                        <div class="card-label">
                            <div>å¤§ä¸‰å·´ç‰ŒåŠ</div>
                            <div class="card-era">1620</div>
                        </div>
                    </div>
                    <div class="photo-card" data-landmark="b_guia">
                        <img src="demo_assets/b_guia_before.jpg" alt="Guia Lighthouse">
                        <div class="card-label">
                            <div>æ±æœ›æ´‹ç‡ˆå¡”</div>
                            <div class="card-era">1865</div>
                        </div>
                    </div>
                    <div class="photo-card" data-landmark="c_st_dominic">
                        <img src="demo_assets/c_st_dominic_before.jpg" alt="St. Dominic's">
                        <div class="card-label">
                            <div>è–å¤šæ˜æˆ‘æ•™å ‚</div>
                            <div class="card-era">1920s</div>
                        </div>
                    </div>
                    <div class="photo-card special" data-landmark="d_himeji">
                        <div class="new-badge">âœ¨ NEW</div>
                        <img src="demo_assets/d_himeji_before.jpg" alt="Himeji Castle">
                        <div class="card-label">
                            <div>å§¬è·¯åŸ</div>
                            <div class="card-era">1600 | ğŸ­ äººç‰©ç©¿è¶Š</div>
                        </div>
                    </div>
                    <div class="photo-card" data-landmark="e_kobe">
                        <img src="demo_assets/e_kobe_before.jpg" alt="Kobe Kitano Ijinkan">
                        <div class="card-label">
                            <div>ç¥æˆ¶ç•°äººé¤¨</div>
                            <div class="card-era">1868</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="action-bar">
                <h2 id="viewerTitle">Ruins of Saint Paul's | å¤§ä¸‰å·´ç‰ŒåŠ</h2>
                <button class="btn-primary" id="reconstructBtn">ğŸ”„ å•Ÿå‹•æ™‚ç©ºé‡å»º</button>
            </div>

            <div class="slider-container locked" id="sliderContainer">
                <div class="slider-bg" id="sliderBg"></div>
                <img src="demo_assets/a_st_pauls_before.jpg" alt="Before" class="slider-image before" id="beforeImage">
                <img src="demo_assets/a_st_pauls_after.jpg" alt="After" class="slider-image after" id="afterImage">
                <div class="slider-handle" id="sliderHandle"></div>
                
                <!-- Processing Overlay -->
                <div id="processingOverlay" class="processing-overlay">
                    <div class="fog-effect"></div>
                    <div class="chicken-mascot">ğŸ“</div>
                    <div class="sakura-container" id="sakuraContainer"></div>
                    <div class="pipeline-display">
                        <p class="pipeline-step" data-step="1">ğŸ“ Maps API â€“ Identify location</p>
                        <p class="pipeline-step" data-step="2">ğŸ“š Books API â€“ Retrieve historical references</p>
                        <p class="pipeline-step" data-step="3">ğŸ” Search â€“ Contextual grounding</p>
                        <p class="pipeline-step" data-step="4">ğŸ¤– Gemini Reasoning â€“ Cross-validation</p>
                        <p class="pipeline-step" data-step="5">âœ¨ Imagen 3 â€“ Visual reconstruction</p>
                    </div>
                </div>
            </div>
            
            <!-- Live Demo CTA Button (Below Slider) -->
            <div class="live-demo-cta">
                <a href="https://ai.studio/apps/drive/1iSQUWgVyo_51Jmdpw5P_V0LEl4WTJTRr" 
                   target="_blank" 
                   class="btn-try-live"
                   title="Upload your photo and transform into historical figure">
                    ğŸ¨ Try Live Demo in AI Studio â†’
                </a>
                <p class="cta-hint">Upload YOUR photo | Powered by Gemini 3 Preview + Nano Banana</p>
            </div>
        </section>

        <aside class="side-panel">
            <div class="panel-card">
                <h4>ğŸ“Š Reconstruction Plan</h4>
                <div class="info-grid">
                    <div class="info-row">
                        <span class="info-label">Run ID</span>
                        <span class="info-value" id="infoRunId">20260103-001</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Landmark</span>
                        <span class="info-value" id="infoLandmark">Ruins of Saint Paul's</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">View</span>
                        <span class="info-value" id="infoView">High Angle</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Tier</span>
                        <span class="info-value tier-hero" id="infoTier">HERO</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Confidence</span>
                        <span class="info-value" id="infoConfidence">0.92</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Source</span>
                        <span class="info-value" id="infoSource">cached</span>
                    </div>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" id="confidenceFill" style="width: 92%"></div>
                </div>
            </div>

            <div class="panel-card">
                <h4>ğŸ“œ æ™‚ç©ºå°éŠ</h4>
                <div class="narrative-box" id="narrativeBox">
                    <p class="narrative-text visible">é»æ“Šã€Œå•Ÿå‹•æ™‚ç©ºé‡å»ºã€é–‹å§‹é«”é©—...</p>
                </div>
            </div>

            <div class="panel-card">
                <h4>ğŸ” Assumptions</h4>
                <ul class="assumptions-list" id="assumptionsList">
                    <li>Church nave ~30m behind facade</li>
                    <li>Red clay tile roof</li>
                    <li>College buildings adjacent</li>
                </ul>
            </div>
        </aside>
    </main>

    <footer class="footer">
        <p>ğŸ“ Chronos Layer | Gemini 3 Hackathon 2026</p>
        <p style="margin-top:0.3rem">"Historically-informed hypotheses, not definitive truth."</p>
    </footer>

    <div class="completion-modal" id="completionModal">
        <div class="msg">âœ“ Structure Rebuilt</div>
        <button class="primary" onclick="returnToSelection()">è¿”å›åœ°é»é¸æ“‡</button>
        <button onclick="replayReconstruction()">å†æ¬¡é‡å»º</button>
    </div>

    <script>
        /* ========================================
         * CHRONOS LAYER - Multimodal Time Reconstruction
         * Gemini 3 Hackathon 2026
         * ========================================
         * 
         * å°ˆæ¡ˆæ¦‚è¿°ï¼š
         * é€™æ˜¯ä¸€å€‹ã€Œæ™‚ç©ºç©¿è¶Šã€å½±åƒè½‰æ›ç³»çµ±ï¼Œä½¿ç”¨ Gemini 3 çš„å¤šæ¨¡æ…‹èƒ½åŠ›
         * å°‡ç¾ä»£ç…§ç‰‡é‡å»ºç‚ºæ­·å²å ´æ™¯ã€‚
         * 
         * æ ¸å¿ƒç†å¿µï¼š
         * "Historically-informed hypotheses, not definitive truth."
         * - ä¸æ˜¯ã€ŒçœŸç›¸ã€ï¼Œè€Œæ˜¯ã€Œæœ‰æ ¹æ“šçš„æ­·å²æ¨ç†ã€
         * - å±•ç¤º AI å¦‚ä½•æ•´åˆå¤šç¨®è³‡è¨Šæºé€²è¡Œæ¨ç†
         * 
         * æŠ€è¡“æ¶æ§‹ï¼š
         * 
         * 1. åœ–ç‰‡ç”Ÿæˆï¼š
         *    - AI Studio: Gemini 3 Preview + Nano Banana
         *    - Pre-generated: Gemini 3 Pro + Nano Banana Pro
         * 
         * 2. ç³»çµ±è¨­è¨ˆï¼ˆ6 API æ¶æ§‹ï¼Œç›®å‰å¯¦ä½œæ ¸å¿ƒåŠŸèƒ½ï¼‰ï¼š
         *    âœ… Nano Banana Pro - åœ–ç‰‡ç”Ÿæˆï¼ˆå·²å¯¦ä½œï¼‰
         *    ğŸ“‹ Gemini Vision - å ´æ™¯åˆ†æï¼ˆè¨­è¨ˆä¸­ï¼‰
         *    ğŸ“‹ Google Maps API - åœ°é»è­˜åˆ¥ï¼ˆè¨­è¨ˆä¸­ï¼‰
         *    ğŸ“‹ Google Books API - æ­·å²ç ”ç©¶ï¼ˆè¨­è¨ˆä¸­ï¼‰
         *    ğŸ“‹ Google Search API - èƒŒæ™¯è³‡æ–™ï¼ˆè¨­è¨ˆä¸­ï¼‰
         *    ğŸ“‹ Gemini Reasoning - äº¤å‰é©—è­‰ï¼ˆè¨­è¨ˆä¸­ï¼‰
         * 
         * 3. åœ°æ¨™é¸æ“‡é‚è¼¯ï¼š
         *    
         *    ç‚ºä»€éº¼æ˜¯é€™5å€‹åœ°æ¨™ï¼Ÿ
         *    
         *    æ¾³é–€3å€‹ï¼ˆå»ºç¯‰é‡å»ºï¼‰ï¼š
         *    - å¤§ä¸‰å·´ç‰ŒåŠï¼š1835å¹´å¤§ç«å‰çš„å®Œæ•´æ•™å ‚ï¼ˆå±•ç¤ºã€Œä¸å¯èƒ½çš„ç…§ç‰‡ã€ï¼‰
         *    - æ±æœ›æ´‹ç‡ˆå¡”ï¼š1865å¹´æµ·å²¸ç·šï¼ˆå±•ç¤ºç’°å¢ƒè®Šé·ï¼‰
         *    - è–å¤šæ˜æˆ‘æ•™å ‚ï¼š1920s é»ƒæ¨Ÿæœ¨çµæ§‹ï¼ˆå±•ç¤ºå¤œâ†’æ—¥è½‰æ›ï¼‰
         *    
         *    æ—¥æœ¬2å€‹ï¼ˆäººç‰©è½‰æ›ï¼‰ï¼š
         *    - å§¬è·¯åŸï¼š1600å¹´æˆ°åœ‹æ­¦å£«ï¼ˆå±•ç¤ºäººç‰©è½‰æ› + æœè£ç ”ç©¶ï¼‰
         *    - ç¥æˆ¶ç•°äººé¤¨ï¼š1868å¹´æ˜æ²»æ­¦å£« + B&Wï¼ˆå±•ç¤º AI æ™‚ä»£æ¨ç†ï¼‰
         *    
         *    è¨­è¨ˆè€ƒé‡ï¼š
         *    - å¾ç°¡å–®åˆ°è¤‡é›œï¼šå»ºç¯‰é‡å»º â†’ äººç‰©è½‰æ›
         *    - åœ°åŸŸå¹³è¡¡ï¼šæ¾³é–€ï¼ˆé–‹ç™¼è€…æ•…é„‰ï¼‰+ æ—¥æœ¬ï¼ˆæŠ€è¡“é›£åº¦ï¼‰
         *    - æ­·å²è·¨åº¦ï¼š1600 â†’ 1920sï¼ˆå±•ç¤ºä¸åŒæ™‚ä»£çš„è™•ç†èƒ½åŠ›ï¼‰
         * 
         * 4. UX è¨­è¨ˆå“²å­¸ï¼š
         *    
         *    è™•ç†ç­‰å¾…æ™‚é–“ï¼ˆ18ç§’ï¼‰çš„ç­–ç•¥ï¼š
         *    - éœ§é¢é®æ“‹ï¼šå‘ŠçŸ¥ã€Œæ­£åœ¨è™•ç†ã€
         *    - åœ°åŸŸå‹•ç•«ï¼šå…¬é›ï¼ˆæ¾³é–€ï¼‰/ æ«»èŠ±ï¼ˆæ—¥æœ¬ï¼‰â†’ å¨›æ¨‚ + æ–‡åŒ–è­˜åˆ¥
         *    - Pipeline å±•ç¤ºï¼šæ•™è‚²ç”¨æˆ¶ã€ŒAI åœ¨åšä»€éº¼ã€â†’ å¢åŠ é€æ˜åº¦å’Œä¿¡ä»»
         *    
         *    ç›®æ¨™ï¼šå°‡ã€Œç­‰å¾…ã€è®Šæˆã€Œå­¸ç¿’é«”é©—ã€
         * 
         * 5. ç‰¹æ®ŠåŠŸèƒ½ï¼š
         *    
         *    - NEW å¾½ç« ï¼šå§¬è·¯åŸæ¨™è¨˜ã€Œäººç‰©è½‰æ›ã€æŠ€è¡“çªç ´
         *    - B&W æ•ˆæœï¼šç¥æˆ¶è‡ªå‹•æ‡‰ç”¨é»‘ç™½ï¼ˆAI æ¨ç† 1868 = æ—©æœŸæ”å½±ï¼‰
         *    - é›™èªç³»çµ±ï¼šä¸­è‹±åˆ‡æ›ï¼ˆç¹é«”ä¸­æ–‡ / Englishï¼‰
         * 
         * é–‹ç™¼åœ˜éšŠï¼š
         * - Chloeï¼šæ¦‚å¿µã€æ­·å²ç ”ç©¶ã€å°ˆæ¡ˆç®¡ç†
         * - é˜¿å¯¶ (Claude)ï¼šæŠ€è¡“å¯¦ä½œã€æ¶æ§‹è¨­è¨ˆã€æ–‡æª”
         * - Jimmy (Gemini)ï¼šéŒ¯å­—æª¢æŸ¥ã€é‚è¼¯é©—è­‰
         * - æ›¦ (GPT)ï¼šæŠ€è¡“å¯©æ ¸
         * 
         * ======================================== */
        
        // èªè¨€ç³»çµ±
        let currentLang = 'zh'; // é è¨­ç¹é«”ä¸­æ–‡

        const translations = {
            zh: {
                tagline: 'Multimodal Time Reconstruction',
                selectLandmark: 'ğŸ“ Select Landmark',
                reconstructBtn: 'ğŸ”„ å•Ÿå‹•æ™‚ç©ºé‡å»º',
                reconstructionPlan: 'ğŸ“Š Reconstruction Plan',
                runId: 'Run ID',
                landmark: 'Landmark',
                view: 'View',
                tier: 'Tier',
                confidence: 'Confidence',
                source: 'Source',
                timeGuide: 'ğŸ“œ æ™‚ç©ºå°éŠ',
                assumptions: 'ğŸ” Assumptions',
                initialText: 'é»æ“Šã€Œå•Ÿå‹•æ™‚ç©ºé‡å»ºã€é–‹å§‹é«”é©—...',
                modalMsg: 'âœ“ Structure Rebuilt',
                returnBtn: 'è¿”å›åœ°é»é¸æ“‡',
                replayBtn: 'å†æ¬¡é‡å»º',
                footer1: 'ğŸ“ Chronos Layer | Gemini 3 Hackathon 2026',
                footer2: '"Historically-informed hypotheses, not definitive truth."',
                // æ™¯é»åç¨±
                stPauls: 'å¤§ä¸‰å·´ç‰ŒåŠ',
                guia: 'æ±æœ›æ´‹ç‡ˆå¡”',
                stDominic: 'è–å¤šæ˜æˆ‘æ•™å ‚',
                himeji: 'å§¬è·¯åŸ',
                kobe: 'ç¥æˆ¶ç•°äººé¤¨'
            },
            en: {
                tagline: 'Multimodal Time Reconstruction',
                selectLandmark: 'ğŸ“ Select Landmark',
                reconstructBtn: 'ğŸ”„ Start Reconstruction',
                reconstructionPlan: 'ğŸ“Š Reconstruction Plan',
                runId: 'Run ID',
                landmark: 'Landmark',
                view: 'View',
                tier: 'Tier',
                confidence: 'Confidence',
                source: 'Source',
                timeGuide: 'ğŸ“œ Time Guide',
                assumptions: 'ğŸ” Assumptions',
                initialText: 'Click "Start Reconstruction" to begin...',
                modalMsg: 'âœ“ Structure Rebuilt',
                returnBtn: 'Return to Selection',
                replayBtn: 'Replay',
                footer1: 'ğŸ“ Chronos Layer | Gemini 3 Hackathon 2026',
                footer2: '"Historically-informed hypotheses, not definitive truth."',
                // æ™¯é»åç¨±
                stPauls: "Ruins of Saint Paul's",
                guia: 'Guia Lighthouse',
                stDominic: "St. Dominic's Church",
                himeji: 'Himeji Castle',
                kobe: 'Kobe Kitano Ijinkan'
            }
        };

        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            const btn = document.getElementById('langToggle');
            btn.textContent = currentLang === 'zh' ? 'ğŸŒ EN' : 'ğŸŒ ä¸­æ–‡';
            updateUILanguage();
        }

        function updateUILanguage() {
            const t = translations[currentLang];
            
            // æ›´æ–°éœæ…‹æ–‡å­—
            document.querySelector('.tagline').textContent = t.tagline;
            document.querySelector('.photo-selection h3').textContent = t.selectLandmark;
            document.getElementById('reconstructBtn').textContent = t.reconstructBtn;
            
            // æ›´æ–°å´é‚Šé¢æ¿æ¨™é¡Œ
            document.querySelectorAll('.panel-card h4')[0].textContent = t.reconstructionPlan;
            document.querySelectorAll('.panel-card h4')[1].textContent = t.timeGuide;
            document.querySelectorAll('.panel-card h4')[2].textContent = t.assumptions;
            
            // æ›´æ–°info-label
            const labels = document.querySelectorAll('.info-label');
            labels[0].textContent = t.runId;
            labels[1].textContent = t.landmark;
            labels[2].textContent = t.view;
            labels[3].textContent = t.tier;
            labels[4].textContent = t.confidence;
            labels[5].textContent = t.source;
            
            // æ›´æ–°modalæŒ‰éˆ•
            document.querySelector('.completion-modal .msg').textContent = t.modalMsg;
            document.querySelector('.completion-modal button.primary').textContent = t.returnBtn;
            document.querySelector('.completion-modal button:not(.primary)').textContent = t.replayBtn;
            
            // æ›´æ–°footer
            const footerP = document.querySelectorAll('.footer p');
            footerP[0].textContent = t.footer1;
            footerP[1].textContent = t.footer2;
            
            // æ›´æ–°æ™¯é»å¡ç‰‡æ¨™ç±¤
            const cards = document.querySelectorAll('.photo-card');
            cards[0].querySelector('.card-label div:first-child').textContent = t.stPauls;
            cards[1].querySelector('.card-label div:first-child').textContent = t.guia;
            cards[2].querySelector('.card-label div:first-child').textContent = t.stDominic;
            cards[3].querySelector('.card-label div:first-child').textContent = t.himeji;
            cards[4].querySelector('.card-label div:first-child').textContent = t.kobe;
            
            // æ›´æ–°narrativeåˆå§‹æ–‡å­—ï¼ˆå¦‚æœé‚„æ²’é–‹å§‹é‡å»ºï¼‰
            if (!isProcessing && !isRebuilt) {
                const narrativeBox = document.getElementById('narrativeBox');
                const initialP = narrativeBox.querySelector('.narrative-text');
                if (initialP) {
                    initialP.textContent = t.initialText;
                }
            }
        }

        const landmarkData = {
            a_st_pauls: {
                input: 'demo_assets/a_st_pauls_before.jpg',
                output: 'demo_assets/a_st_pauls_after.jpg',
                plan: { run_id: '20260103-001', landmark: "Ruins of Saint Paul's", view: 'High Angle', tier: 'HERO', confidence: 0.92, source: 'cached', era: '1620' },
                assumptions: [
                    'Church nave ~30m behind facade', 
                    'Red clay tile roof', 
                    'College buildings adjacent', 
                    '17th century hillside'
                ],
                narrative: [
                    {time: 0, text: 'â³ Initiating volumetric reconstruction...'},
                    {time: 2, text: 'ğŸ“ St. Paul\'s Ruins, Macau. Only the facade remains.'},
                    {time: 5, text: 'ğŸ”¥ Before the 1835 typhoon fire, this was the "Vatican of the East".'},
                    {time: 8, text: 'ğŸ›ï¸ Behind this wall stood a 30-meter nave and the first Western college in Far East.'},
                    {time: 12, text: 'ğŸ¨ Reconstructing the lost structure from historical records...'},
                    {time: 14, text: 'âœ… Structure Rebuilt'}
                ]
            },
            b_guia: {
                input: 'demo_assets/b_guia_before.jpg',
                output: 'demo_assets/b_guia_after.jpg',
                plan: { run_id: '20260103-002', landmark: 'Guia Lighthouse', view: 'Elevated', tier: 'HERO', confidence: 0.88, source: 'cached', era: '1865' },
                assumptions: [
                    'Sea level restored to 19th century', 
                    'Casinos removed', 
                    'Chinese junks in harbor', 
                    'Lighthouse as primary light'
                ],
                narrative: [
                    {time: 0, text: 'ğŸ“ Guia Lighthouse, 91 meters above sea level.'},
                    {time: 2, text: 'ğŸ’¡ 1865: First modern lighthouse on the China coast.'},
                    {time: 5, text: 'ğŸŒ€ This mast displays typhoon warning signals.'},
                    {time: 8, text: 'ğŸ§­ Ground zero for ships\' navigation coordinates.'},
                    {time: 11, text: 'ğŸŒŠ Removing casinos, restoring the 19th-century coastline...'},
                    {time: 14, text: 'âœ… Typhoon Signal Hoisted'}
                ]
            },
            c_st_dominic: {
                input: 'demo_assets/c_st_dominic_before.jpg',
                output: 'demo_assets/c_st_dominic_after.jpg',
                plan: { run_id: '20260103-003', landmark: "St. Dominic's", view: 'Front', tier: 'KNOWLEDGE', confidence: 0.85, source: 'cached', era: '1920s' },
                assumptions: [
                    'Structure unchanged since 1587', 
                    'Night to daytime conversion', 
                    'Modern elements removed', 
                    'Rickshaws added'
                ],
                narrative: [
                    {time: 0, text: 'ğŸ” Detecting Baroque signal... Locked to 1587.'},
                    {time: 2, text: 'â›ª Founded by three Spanish Dominican friars.'},
                    {time: 5, text: 'ğŸŒ³ Secret: Built with camphor wood, once called "Camphor Wood Hall".'},
                    {time: 8, text: 'ğŸ“° 1822: China\'s first foreign-language newspaper printed here.'},
                    {time: 11, text: 'ğŸ¨ Removing modern noise, restoring the scent of wood...'},
                    {time: 14, text: 'âœ… Restoration Complete'}
                ]
            },
            d_himeji: {
                input: 'demo_assets/d_himeji_before.jpg',
                output: 'demo_assets/d_himeji_after.jpg',
                plan: { 
                    run_id: '20260126-001', 
                    landmark: 'Himeji Castle / å§¬è·¯åŸ', 
                    view: 'Street Level with Person', 
                    tier: 'HERO', 
                    confidence: 0.95, 
                    source: 'persona_transformation', 
                    era: '1600' 
                },
                assumptions: [
                    'ğŸ“ Location: Himeji Castle, Hyogo Prefecture (via Maps API)',
                    'ğŸ“š Historical Ref: ã€Šæ—¥æœ¬æˆ°åœ‹å²æ–™é›†ã€‹(via Books API)',
                    'âš”ï¸ Era: 1600, Sengoku Period under Ikeda Terumasa',
                    'ğŸ¨ Armor: Tosei-gusoku (lacquered scale armor)',
                    'ğŸª– Helmet: Kabuto with deer antler ornament',
                    'ğŸ—¡ï¸ Weapon: Katana (samurai standard)',
                    'ğŸ¯ Background: Castle town marketplace',
                    'ğŸ¤– Tech: Gemini Vision + Reasoning + Imagen 3'
                ],
                narrative: [
                    { time: 0, text: 'â³ Initiating personal time-travel transformation...' },
                    { time: 2, text: 'ğŸ“ Location identified: Himeji Castle, built 1346, renovated 1600.' },
                    { time: 5, text: 'ğŸ“š Historical research: 1600 Sengoku era, red-black Tosei-gusoku armor style.' },
                    { time: 8, text: 'ğŸ¤– AI reasoning: Posture + lighting â†’ High-ranking samurai reconstruction.' },
                    { time: 11, text: 'ğŸ¯ Background: Castle town marketplace with wooden shops and teahouses.' },
                    { time: 14, text: 'ğŸ­ Details: Townspeople, samurai, merchants in 400-year-old street scene.' },
                    { time: 17, text: 'âœ¨ Complete! Multimodal historical reconstruction with facial preservation.' }
                ]
            },
            e_kobe: {
                /* ç¥æˆ¶ç•°äººé¤¨ - å±•ç¤º AI çš„ã€Œæ™‚ä»£æ¨ç†èƒ½åŠ›ã€
                 * 
                 * ç‚ºä»€éº¼æ˜¯é»‘ç™½ç…§ç‰‡ï¼Ÿ
                 * 
                 * AI è‡ªå‹•æ¨ç†é‚è¼¯ï¼š
                 * 1. ç”¨æˆ¶æŒ‡å®š era: 1868ï¼ˆæ˜æ²»å…ƒå¹´ï¼‰
                 * 2. AI çŸ¥è­˜åº«ï¼šæ”å½±è¡“ç™¼æ˜æ–¼ 1839 å¹´
                 * 3. æ¨ç†ï¼š1868 - 1839 = 29å¹´ â†’ æ”å½±è¡“å‰›å¼•å…¥æ—¥æœ¬
                 * 4. çµè«–ï¼š1868 å¹´çš„ç…§ç‰‡å¿…ç„¶æ˜¯é»‘ç™½çš„ï¼ˆå½©è‰²æ”å½±è¦åˆ°1930sï¼‰
                 * 5. è‡ªå‹•æ‡‰ç”¨ï¼šSepia tone æ•ˆæœ
                 * 
                 * é€™å±•ç¤ºäº†ä»€éº¼ï¼Ÿ
                 * - Gemini çš„ã€Œæ™‚é–“æ™ºèƒ½ã€ï¼šç†è§£æŠ€è¡“å²çš„æ™‚é–“ç·š
                 * - è‡ªå‹•ç´„æŸï¼šä¸éœ€è¦æ‰‹å‹•æŒ‡å®šã€Œè¦é»‘ç™½ã€ï¼ŒAI è‡ªå·±æ¨ç†
                 * - æ­·å²æº–ç¢ºæ€§ï¼šé¿å…ã€Œ1868å¹´çš„å½©è‰²ç…§ç‰‡ã€é€™ç¨®éŒ¯èª¤
                 * 
                 * ç‚ºä»€éº¼é€™å¾ˆé‡è¦ï¼Ÿ
                 * - è­‰æ˜ç³»çµ±ä¸æ˜¯ã€Œå¥—æ¿¾é¡ã€ï¼Œè€Œæ˜¯ã€Œç†è§£æ­·å²ã€
                 * - å±•ç¤º multimodal reasoning çš„åƒ¹å€¼
                 * - é€™æ˜¯ Gemini 3 çš„æ ¸å¿ƒèƒ½åŠ›å±•ç¤º
                 * 
                 * åƒè€ƒï¼š
                 * - Assumptions è£¡çš„ 'ğŸ“¸ Photo Tech: 1868 = B&W photography'
                 * - Narrative ç¬¬2å¥ï¼š'AI meta-reasoning: 1868 = Early photography era'
                 */
                input: 'demo_assets/e_kobe_before.jpg',
                output: 'demo_assets/e_kobe_after.jpg',
                plan: { 
                    run_id: '20260126-002', 
                    landmark: 'Kobe Kitano Ijinkan / ç¥æˆ¶åŒ—é‡ç•°äººé¤¨', 
                    view: 'Street Level with Person', 
                    tier: 'HERO', 
                    confidence: 0.93, 
                    source: 'persona_transformation', 
                    era: '1868' 
                },
                assumptions: [
                    'ğŸ“ Location: Kobe Kitano Ijinkan District (via Maps)',
                    'ğŸ“š Historical Ref: ã€Šå¹•æœ«æ˜æ²»å¯«çœŸå²ã€‹(via Books API)',
                    'ğŸ“¸ Photo Tech: 1868 = B&W photography (sepia tone)',
                    'ğŸ­ Era: Meiji Restoration Year 1 (1868)',
                    'ğŸ‘” Clothing: Haori (outer robe) + Hakama + Twin swords',
                    'ğŸ‘“ Eyeglasses: Common among scholar-samurai by 1868',
                    'ğŸ›ï¸ Background: Foreign settlement district',
                    'ğŸ¤– Tech: Gemini Vision + Historical Reasoning + Imagen 3'
                ],
                narrative: [
                    { time: 0, text: 'â³ Initiating reconstruction... Meiji Year 1 (1868).' },
                    { time: 2, text: 'ğŸ“¸ AI meta-reasoning: 1868 = Early photography era â†’ Automatic sepia tone applied.' },
                    { time: 5, text: 'ğŸ“ Location: Kobe Kitano Ijinkan, foreign settlement district opened 1868.' },
                    { time: 8, text: 'ğŸ“š Research: Meiji samurai wore haori + hakama, no longer armor.' },
                    { time: 11, text: 'ğŸ‘“ Historical validation: Eyeglasses retained (common among scholar-samurai since 1600s).' },
                    { time: 14, text: 'ğŸ›ï¸ Background: Western-style mansions, rickshaws, cultural fusion of early Meiji.' },
                    { time: 17, text: 'âœ¨ Complete! B&W photography + Meiji attire + Western architecture.' }
                ]
            }
        };

        let currentLandmark = 'a_st_pauls';
        let isProcessing = false;
        let isRebuilt = false;

        const slider = document.getElementById('sliderContainer');
        const handle = document.getElementById('sliderHandle');
        const afterImage = document.getElementById('afterImage');
        const beforeImage = document.getElementById('beforeImage');
        const sliderBg = document.getElementById('sliderBg');
        let isDragging = false;

        // åˆå§‹åŒ–ï¼šè¨­ç½®æ¨¡ç³ŠèƒŒæ™¯
        function updateBlurredBackground() {
            const currentData = landmarkData[currentLandmark];
            sliderBg.style.backgroundImage = `url('${currentData.input}')`;
        }
        updateBlurredBackground();

        // é¸æ“‡æ™¯é»
        document.querySelectorAll('.photo-card').forEach(card => {
            card.addEventListener('click', () => {
                if (isProcessing) return;
                
                const landmark = card.dataset.landmark;
                currentLandmark = landmark;
                
                document.querySelectorAll('.photo-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                
                selectLandmark(landmark);
            });
        });

        function selectLandmark(id) {
            const data = landmarkData[id];
            
            beforeImage.src = data.input;
            afterImage.src = data.output;
            updateBlurredBackground();
            
            document.getElementById('viewerTitle').textContent = data.plan.landmark;
            document.getElementById('infoRunId').textContent = data.plan.run_id;
            document.getElementById('infoLandmark').textContent = data.plan.landmark.split(' / ')[0];
            document.getElementById('infoView').textContent = data.plan.view;
            document.getElementById('infoTier').textContent = data.plan.tier;
            document.getElementById('infoTier').className = 'info-value tier-' + data.plan.tier.toLowerCase();
            document.getElementById('infoConfidence').textContent = data.plan.confidence;
            document.getElementById('infoSource').textContent = data.plan.source;
            document.getElementById('confidenceFill').style.width = (data.plan.confidence * 100) + '%';
            
            const assumptionsList = document.getElementById('assumptionsList');
            assumptionsList.innerHTML = data.assumptions.map(a => `<li>${a}</li>`).join('');
            
            const narrativeBox = document.getElementById('narrativeBox');
            narrativeBox.innerHTML = '<p class="narrative-text visible">Click "Start Reconstruction" to begin...</p>';
            
            slider.classList.add('locked');
            slider.classList.remove('revealed');
            afterImage.classList.remove('developing');
            afterImage.style.opacity = '0';
            afterImage.style.clipPath = 'inset(0 100% 0 0)';
            handle.style.left = '50%';
            
            isRebuilt = false;
            document.getElementById('reconstructBtn').disabled = false;
            document.getElementById('completionModal').classList.remove('show');
        }

        // å•Ÿå‹•é‡å»º
        document.getElementById('reconstructBtn').addEventListener('click', function() {
            if (isProcessing || isRebuilt) return;
            
            isProcessing = true;
            this.disabled = true;
            
            const data = landmarkData[currentLandmark];
            const narrativeBox = document.getElementById('narrativeBox');
            narrativeBox.innerHTML = '';
            
            // === PATCH: Processing Overlay ===
            const overlay = document.getElementById('processingOverlay');
            const sakuraContainer = document.getElementById('sakuraContainer');
            const isMacau = ['a_st_pauls', 'b_guia', 'c_st_dominic'].includes(currentLandmark);
            const isJapan = ['d_himeji', 'e_kobe'].includes(currentLandmark);
            
            if (overlay && (isMacau || isJapan)) {
                // è¨­å®šæ¨£å¼é¡åˆ¥
                overlay.classList.remove('macau', 'japan');
                if (isMacau) overlay.classList.add('macau');
                if (isJapan) overlay.classList.add('japan');
                
                // æ—¥æœ¬åœ°æ¨™ï¼šç”Ÿæˆæ«»èŠ±èŠ±ç“£
                if (isJapan && sakuraContainer) {
                    sakuraContainer.innerHTML = '';
                    for (let i = 0; i < 20; i++) {
                        const petal = document.createElement('div');
                        petal.className = 'sakura-petal';
                        petal.textContent = 'ğŸŒ¸';
                        petal.style.left = Math.random() * 100 + '%';
                        petal.style.animationDuration = (4 + Math.random() * 3) + 's';
                        petal.style.animationDelay = (Math.random() * 1.5) + 's';
                        sakuraContainer.appendChild(petal);
                    }
                }
                
                overlay.classList.add('active');
                
                // é€æ­¥é¡¯ç¤º Pipeline (0.6ç§’é–“éš”)
                const steps = overlay.querySelectorAll('.pipeline-step');
                steps.forEach((step, idx) => {
                    setTimeout(() => {
                        step.classList.add('visible');
                    }, idx * 600);
                });
                
                // overlay æœƒåœ¨ completion modal å‡ºç¾å‰æ‰éš±è—ï¼ˆè¦‹ä¸‹æ–¹ï¼‰
            }
            // === END PATCH ===
            
            afterImage.classList.add('developing');
            afterImage.style.opacity = '1';
            
            slider.classList.remove('locked');
            
            setTimeout(() => {
                afterImage.classList.remove('developing');
                slider.classList.add('revealed');
            }, 3000);
            
            data.narrative.forEach((item, index) => {
                setTimeout(() => {
                    const p = document.createElement('p');
                    p.className = 'narrative-text';
                    p.textContent = item.text;
                    narrativeBox.appendChild(p);
                    
                    setTimeout(() => p.classList.add('visible'), 50);
                    
                    if (index === data.narrative.length - 1) {
                        setTimeout(() => {
                            // éš±è— processing overlay
                            const overlay = document.getElementById('processingOverlay');
                            const sakuraContainer = document.getElementById('sakuraContainer');
                            if (overlay) {
                                overlay.classList.remove('active');
                                const steps = overlay.querySelectorAll('.pipeline-step');
                                steps.forEach(s => s.classList.remove('visible'));
                                if (sakuraContainer) {
                                    sakuraContainer.innerHTML = '';
                                }
                            }
                            
                            isProcessing = false;
                            isRebuilt = true;
                            document.getElementById('completionModal').classList.add('show');
                        }, 1000);
                    }
                }, item.time * 1000);
            });
        });

        // æ»‘æ¡¿æ‹–å‹•
        handle.addEventListener('mousedown', () => isDragging = true);
        document.addEventListener('mouseup', () => isDragging = false);
        document.addEventListener('mousemove', (e) => {
            if (!isDragging || !isRebuilt) return;
            const rect = slider.getBoundingClientRect();
            let x = Math.max(0, Math.min(100, (e.clientX - rect.left) / rect.width * 100));
            handle.style.left = x + '%';
            afterImage.style.clipPath = `inset(0 ${100 - x}% 0 0)`;
        });

        // è§¸æ§æ”¯æ´
        handle.addEventListener('touchstart', () => isDragging = true);
        document.addEventListener('touchend', () => isDragging = false);
        document.addEventListener('touchmove', (e) => {
            if (!isDragging || !isRebuilt) return;
            const rect = slider.getBoundingClientRect();
            let x = Math.max(0, Math.min(100, (e.touches[0].clientX - rect.left) / rect.width * 100));
            handle.style.left = x + '%';
            afterImage.style.clipPath = `inset(0 ${100 - x}% 0 0)`;
        });

        function returnToSelection() {
            document.getElementById('completionModal').classList.remove('show');
        }

        function replayReconstruction() {
            document.getElementById('completionModal').classList.remove('show');
            selectLandmark(currentLandmark);
            setTimeout(() => {
                document.getElementById('reconstructBtn').click();
            }, 500);
        }
    </script>
</body>
</html>
